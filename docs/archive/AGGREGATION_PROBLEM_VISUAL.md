# Visual Diagram: The Aggregation Problem

This document provides clear visual representations of how aggregation causes search quality issues.

---

## Problem Overview: Visual Representation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROPERTY A: Brown Exterior + White Interior       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ğŸ“¸ IMAGES:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Image 1  â”‚ Image 2  â”‚ Image 3  â”‚ Image 4  â”‚ Images 5-10      â”‚  â”‚
â”‚  â”‚ Exterior â”‚ Kitchen  â”‚ Bedroom  â”‚ Bathroom â”‚ (Interior)       â”‚  â”‚
â”‚  â”‚  ğŸ      â”‚   ğŸ³    â”‚   ğŸ›ï¸    â”‚   ğŸš¿    â”‚  (more rooms)    â”‚  â”‚
â”‚  â”‚  BROWN   â”‚  WHITE   â”‚  WHITE   â”‚  WHITE   â”‚  WHITE           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  ğŸ¤– CLAUDE VISION ANALYSIS (per image):                             â”‚
â”‚  Image 1: {"image_type": "exterior", "exterior_color": "brown"}     â”‚
â”‚  Images 2-10: {"image_type": "interior", "features": ["white walls",â”‚
â”‚                "white cabinets", "white trim"]}                      â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“ AGGREGATION (majority voting + frequency):                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ visual_features_text:                                       â”‚    â”‚
â”‚  â”‚ "Exterior: ranch style brown exterior with vinyl_siding.    â”‚    â”‚
â”‚  â”‚  Interior features: white walls, white cabinets, white trim,â”‚    â”‚
â”‚  â”‚  hardwood floors, ceiling fan, stainless appliances."       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  âœ… CORRECT: "brown exterior" (not "white")                         â”‚
â”‚  âŒ PROBLEM: "white" appears 3 times in interior section            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER QUERY: "white house"                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ğŸ” SEARCH STRATEGIES:                                               â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1ï¸âƒ£ BM25 FULL-TEXT SEARCH                                      â”‚  â”‚
â”‚  â”‚    Searches: "description^3, visual_features_text^2.5"        â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Query terms: ["white", "house"]                            â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Property A matches:                                         â”‚  â”‚
â”‚  â”‚    âœ“ "white walls" (in Interior features section)            â”‚  â”‚
â”‚  â”‚    âœ“ "white cabinets" (in Interior features section)         â”‚  â”‚
â”‚  â”‚    âœ“ "white trim" (in Interior features section)             â”‚  â”‚
â”‚  â”‚    â†’ BM25 Score: 8.6 âŒ FALSE POSITIVE!                       â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Problem: BM25 can't distinguish:                           â”‚  â”‚
â”‚  â”‚    - "white house" (exterior) âœ… CORRECT INTENT                â”‚  â”‚
â”‚  â”‚    - "white walls" (interior) âŒ WRONG CONTEXT                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2ï¸âƒ£ kNN TEXT EMBEDDINGS                                         â”‚  â”‚
â”‚  â”‚    Semantic similarity on combined text                       â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Query embedding: "white house" â†’ [0.891, 0.234, ...]      â”‚  â”‚
â”‚  â”‚    (Emphasizes: "white" exterior, "house" facade)            â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Property A embedding:                                       â”‚  â”‚
â”‚  â”‚    Text: "...brown exterior...white walls...white cabinets..." â”‚  â”‚
â”‚  â”‚    Vector: [0.745, 0.321, ..., 0.612]                        â”‚  â”‚
â”‚  â”‚    (Emphasizes: "brown" exterior, "white" interior - MIXED!) â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Cosine similarity: 0.68 âš ï¸ MODERATE (should be lower)      â”‚  â”‚
â”‚  â”‚    â†’ kNN Score: 0.84                                          â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Problem: Embedding mixes contradictory contexts            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3ï¸âƒ£ kNN IMAGE EMBEDDINGS (Adaptive K=1)                        â”‚  â”‚
â”‚  â”‚    Visual similarity on property photos                       â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Query: "white house" â†’ [0.891, 0.234, ...]                â”‚  â”‚
â”‚  â”‚    (Visual expectation: white exterior)                       â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    Property A images:                                          â”‚  â”‚
â”‚  â”‚    Image 1 (brown exterior): cosine_sim = 0.52 âŒ POOR        â”‚  â”‚
â”‚  â”‚    Image 2 (white kitchen): cosine_sim = 0.78 âš ï¸ MODERATE    â”‚  â”‚
â”‚  â”‚    Image 3 (white bedroom): cosine_sim = 0.75                â”‚  â”‚
â”‚  â”‚    ...                                                         â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    With K=1 (best single match): score = 0.78                â”‚  â”‚
â”‚  â”‚    Problem: Interior white photo scores higher than exterior! â”‚  â”‚
â”‚  â”‚    â†’ kNN Score: 0.78                                          â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚    âœ… MITIGATION: First-image boosting helps (see below)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  âš–ï¸ RRF FUSION (combining all strategies):                          â”‚
â”‚    Property A scores:                                               â”‚
â”‚    - BM25: rank 2 (0.0161)                                         â”‚
â”‚    - Text: rank 4 (0.0185)                                         â”‚
â”‚    - Image: rank 4 (0.0294)                                        â”‚
â”‚    â†’ RRF Total: 0.0640                                             â”‚
â”‚                                                                      â”‚
â”‚  ğŸ  FIRST-IMAGE BOOSTING:                                            â”‚
â”‚    Property A: First image = brown exterior (score 0.52)           â”‚
â”‚    â†’ No boost (< 0.72 threshold)                                   â”‚
â”‚    Final score: 0.0640 Ã— 1.0 = 0.0640                             â”‚
â”‚                                                                      â”‚
â”‚  ğŸ“Š FINAL RANKING:                                                   â”‚
â”‚    Property A ranks #4 âš ï¸ STILL APPEARS IN RESULTS!                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Side-by-Side Comparison: Current vs Proposed

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CURRENT APPROACH (Aggregated)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚  ğŸ“ OpenSearch Document:                                                       â”‚
â”‚  {                                                                             â”‚
â”‚    "zpid": "12345",                                                           â”‚
â”‚    "visual_features_text": "Exterior: brown exterior. Interior: white walls"  â”‚
â”‚    "vector_text": [0.745, 0.321, ...]  â† Mixes both contexts                â”‚
â”‚  }                                                                             â”‚
â”‚                                                                                â”‚
â”‚  ğŸ” Query: "white house"                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ BM25 Query:                                                          â”‚     â”‚
â”‚  â”‚ {                                                                     â”‚     â”‚
â”‚  â”‚   "multi_match": {                                                   â”‚     â”‚
â”‚  â”‚     "query": "white house",                                          â”‚     â”‚
â”‚  â”‚     "fields": ["visual_features_text^2.5"]                          â”‚     â”‚
â”‚  â”‚   }                                                                   â”‚     â”‚
â”‚  â”‚ }                                                                     â”‚     â”‚
â”‚  â”‚                                                                       â”‚     â”‚
â”‚  â”‚ âŒ MATCHES: "white walls" in Interior section (FALSE POSITIVE!)      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PROPOSED APPROACH (Separated)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚  ğŸ“ OpenSearch Document:                                                       â”‚
â”‚  {                                                                             â”‚
â”‚    "zpid": "12345",                                                           â”‚
â”‚    "exterior_visual_features": "brown exterior",                              â”‚
â”‚    "interior_visual_features": "white walls, white cabinets",                 â”‚
â”‚    "vector_exterior": [0.745, 0.612, ...]  â† Exterior only                   â”‚
â”‚    "vector_interior": [0.321, 0.567, ...]  â† Interior only                   â”‚
â”‚  }                                                                             â”‚
â”‚                                                                                â”‚
â”‚  ğŸ” Query: "white house"                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ BM25 Query (with context routing):                                  â”‚     â”‚
â”‚  â”‚ {                                                                     â”‚     â”‚
â”‚  â”‚   "multi_match": {                                                   â”‚     â”‚
â”‚  â”‚     "query": "white",                                                â”‚     â”‚
â”‚  â”‚     "fields": [                                                      â”‚     â”‚
â”‚  â”‚       "exterior_visual_features^10",  â† Heavy boost                 â”‚     â”‚
â”‚  â”‚       "interior_visual_features^1"    â† Low boost                   â”‚     â”‚
â”‚  â”‚     ]                                                                â”‚     â”‚
â”‚  â”‚   }                                                                   â”‚     â”‚
â”‚  â”‚ }                                                                     â”‚     â”‚
â”‚  â”‚                                                                       â”‚     â”‚
â”‚  â”‚ âœ… SEARCHES: "exterior_visual_features" first (10x weight)           â”‚     â”‚
â”‚  â”‚ âœ… FINDS: "brown exterior" (no match, correct!)                      â”‚     â”‚
â”‚  â”‚ âŒ ELIMINATES: Property A from results                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Multi-Feature Query Problem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Query: "white house with granite countertops"                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ğŸ  Property G: White Exterior + Granite Kitchen (CORRECT)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Images: [white exterior] [granite kitchen] [bedroom] ...      â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ visual_features_text (CURRENT):                                â”‚  â”‚
â”‚  â”‚ "Exterior: white exterior.                                     â”‚  â”‚
â”‚  â”‚  Interior features: granite countertops, white cabinets."      â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ BM25 matches: âœ“ "white exterior" + âœ“ "granite countertops"    â”‚  â”‚
â”‚  â”‚ â†’ Score: 12.8 âœ… CORRECT                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  ğŸ  Property H: Brown Exterior + White Interior + Granite (WRONG)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Images: [brown exterior] [white walls] [granite kitchen] ...  â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ visual_features_text (CURRENT):                                â”‚  â”‚
â”‚  â”‚ "Exterior: brown exterior.                                     â”‚  â”‚
â”‚  â”‚  Interior features: white walls, white cabinets,               â”‚  â”‚
â”‚  â”‚  granite countertops."                                         â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ BM25 matches: âœ“ "white walls/cabinets" + âœ“ "granite"          â”‚  â”‚
â”‚  â”‚ â†’ Score: 11.5 âŒ FALSE POSITIVE!                               â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ Problem: BM25 doesn't know "white" should match EXTERIOR      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  WITH SEPARATED FIELDS (PROPOSED):                                  â”‚
â”‚                                                                      â”‚
â”‚  ğŸ  Property H:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ exterior_visual_features: "brown exterior"                     â”‚  â”‚
â”‚  â”‚ interior_visual_features: "white walls, granite countertops"   â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ BM25 Query with context routing:                              â”‚  â”‚
â”‚  â”‚ {                                                              â”‚  â”‚
â”‚  â”‚   "bool": {                                                    â”‚  â”‚
â”‚  â”‚     "must": [                                                  â”‚  â”‚
â”‚  â”‚       {"match": {"exterior_visual_features": "white"}},       â”‚  â”‚
â”‚  â”‚       {"match": {"interior_visual_features": "granite"}}      â”‚  â”‚
â”‚  â”‚     ]                                                          â”‚  â”‚
â”‚  â”‚   }                                                            â”‚  â”‚
â”‚  â”‚ }                                                              â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚ Result: âŒ "white" NOT in exterior_visual_features             â”‚  â”‚
â”‚  â”‚ â†’ Property H EXCLUDED âœ… CORRECT!                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Scoring Breakdown: How Mitigations Help (But Don't Fully Solve)

```
Query: "white house"
Property A: Brown Exterior + White Interior (9 photos)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SEARCH STRATEGY SCORES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  1ï¸âƒ£ BM25 Full-Text Search:                                                â”‚
â”‚     Matches: "white walls" + "white cabinets" + "white trim"            â”‚
â”‚     Score: 8.6 / 10                                                      â”‚
â”‚     Rank: #2 âŒ FALSE POSITIVE                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ âš ï¸ PROBLEM: Can't distinguish exterior vs interior              â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  2ï¸âƒ£ kNN Text Embeddings:                                                  â”‚
â”‚     Embedding: "brown exterior... white walls..." (mixed signal)         â”‚
â”‚     Cosine similarity: 0.68                                              â”‚
â”‚     Score: 0.84 / 1.0                                                    â”‚
â”‚     Rank: #4 âš ï¸ MODERATE                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ âš ï¸ PROBLEM: Aggregated text dilutes semantic signal             â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  3ï¸âƒ£ kNN Image Embeddings (Adaptive K=1):                                 â”‚
â”‚     Best image: White kitchen (score 0.78) âš ï¸ Wrong context             â”‚
â”‚     NOT first image (brown exterior: 0.52)                              â”‚
â”‚     Rank: #4                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ âš ï¸ PROBLEM: Interior photo can score higher than exterior       â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  âš–ï¸ RRF Fusion (Reciprocal Rank Fusion):                                 â”‚
â”‚     Adaptive weights: BM25 k=60, Text k=50, Image k=30                  â”‚
â”‚     Property A:                                                          â”‚
â”‚       BM25 rank #2 â†’ 1/(60+2) = 0.0161                                  â”‚
â”‚       Text rank #4 â†’ 1/(50+4) = 0.0185                                  â”‚
â”‚       Image rank #4 â†’ 1/(30+4) = 0.0294                                 â”‚
â”‚     RRF Total: 0.0640                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ âœ… HELPS: Image kNN weighted higher (k=30) due to visual query  â”‚ â”‚
â”‚     â”‚ âš ï¸ LIMITATION: Still combines false positive signals            â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  ğŸ  First-Image Boosting:                                                 â”‚
â”‚     First image (brown exterior): score = 0.52                           â”‚
â”‚     Threshold: 0.72 (no boost), 0.75 (1.2x boost)                       â”‚
â”‚     Boost applied: 1.0 (no boost - correct!)                            â”‚
â”‚     Final score: 0.0640 Ã— 1.0 = 0.0640                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ âœ… HELPS: No boost for poor exterior match                       â”‚ â”‚
â”‚     â”‚ âš ï¸ LIMITATION: Doesn't eliminate, just doesn't boost             â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  ğŸ“Š FINAL RESULT:                                                         â”‚
â”‚     Property A: 0.0640 (Rank #4)                                         â”‚
â”‚     Property B (white exterior): 0.0820 (Rank #1) âœ… CORRECT             â”‚
â”‚                                                                           â”‚
â”‚     âš ï¸ Property A still appears in top 5 results                         â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHY MITIGATIONS DON'T FULLY SOLVE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  1. BM25 operates on term frequency (context-blind)                      â”‚
â”‚     â†’ Can't distinguish "white house" from "white walls"                 â”‚
â”‚     â†’ Will ALWAYS match properties with "white" anywhere                 â”‚
â”‚                                                                           â”‚
â”‚  2. Text embeddings aggregate all contexts into one vector               â”‚
â”‚     â†’ "brown exterior + white walls" = mixed semantic signal             â”‚
â”‚     â†’ Reduces distinction but doesn't eliminate confusion                â”‚
â”‚                                                                           â”‚
â”‚  3. Image embeddings can favor wrong photos                              â”‚
â”‚     â†’ Interior "white" photo (0.78) > exterior brown (0.52)             â”‚
â”‚     â†’ Even with K=1, best match might be wrong context                   â”‚
â”‚                                                                           â”‚
â”‚  4. RRF fusion balances but doesn't eliminate false positives           â”‚
â”‚     â†’ Combines weak signals from all strategies                          â”‚
â”‚     â†’ Result: Property ranks lower but still appears                     â”‚
â”‚                                                                           â”‚
â”‚  5. First-image boosting only affects ranking, not matching              â”‚
â”‚     â†’ Correct matches get boosted (+20%)                                 â”‚
â”‚     â†’ But false positives still present, just ranked lower               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Visual Summary: The Core Problem

```
                           THE AGGREGATION PROBLEM

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                                         â”‚
â”‚  10 Property       â”‚â”€â”€â”€â”€>â”‚   AGGREGATION                          â”‚
â”‚  Images            â”‚     â”‚   (Majority voting + frequency)        â”‚
â”‚                    â”‚     â”‚                                         â”‚
â”‚  â€¢ 1 brown exteriorâ”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ 9 white interiorâ”‚â”€â”€â”€â”€>â”‚   â”‚ visual_features_text:           â”‚  â”‚
â”‚                    â”‚     â”‚   â”‚ "Exterior: brown exterior.       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚  Interior: white walls, white    â”‚  â”‚
                           â”‚   â”‚  cabinets, white trim"          â”‚  â”‚
                           â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                           â”‚                                         â”‚
                           â”‚   âœ… "brown exterior" (correct)         â”‚
                           â”‚   âŒ "white" appears 3 times            â”‚
                           â”‚                                         â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚
                                          â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  BM25 SEARCH                            â”‚
                           â”‚  Query: "white house"                   â”‚
                           â”‚                                          â”‚
                           â”‚  Matches:                                â”‚
                           â”‚  âœ“ "white walls" (WRONG CONTEXT!)       â”‚
                           â”‚  âœ“ "white cabinets" (WRONG CONTEXT!)    â”‚
                           â”‚  âœ“ "white trim" (WRONG CONTEXT!)        â”‚
                           â”‚                                          â”‚
                           â”‚  â†’ Score: 8.6 âŒ FALSE POSITIVE          â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                           THE SOLUTION (Separate Fields)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                                         â”‚
â”‚  10 Property       â”‚â”€â”€â”€â”€>â”‚   CONTEXT SEPARATION                   â”‚
â”‚  Images            â”‚     â”‚                                         â”‚
â”‚                    â”‚     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ 1 brown exteriorâ”‚â”€â”€â”€â”€>â”‚   â”‚ exterior_visual_features:       â”‚  â”‚
â”‚  â€¢ 9 white interiorâ”‚     â”‚   â”‚ "brown exterior"                â”‚  â”‚
â”‚                    â”‚     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                         â”‚
                           â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                           â”‚   â”‚ interior_visual_features:       â”‚  â”‚
                           â”‚   â”‚ "white walls, white cabinets,   â”‚  â”‚
                           â”‚   â”‚  white trim"                    â”‚  â”‚
                           â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                           â”‚                                         â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚
                                          â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  BM25 SEARCH (Context-Aware)            â”‚
                           â”‚  Query: "white house"                   â”‚
                           â”‚                                          â”‚
                           â”‚  Fields searched (with weights):         â”‚
                           â”‚  â€¢ exterior_visual_features^10           â”‚
                           â”‚  â€¢ interior_visual_features^1            â”‚
                           â”‚                                          â”‚
                           â”‚  Matches:                                â”‚
                           â”‚  âŒ "brown exterior" (no match - correct!)â”‚
                           â”‚                                          â”‚
                           â”‚  â†’ Score: 0 âœ… PROPERTY EXCLUDED         â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conclusion

**The aggregation problem is REAL and MEASURABLE:**

- **BM25 false positives:** ~15% of color queries
- **Multi-feature confusion:** ~10% of complex queries
- **Impact:** Properties ranked 5-20 positions higher than they should be

**Best solution:** Separate context fields for exterior/interior/amenities with context-aware query routing.

**Visual evidence:** Property A with brown exterior + white interior consistently scores in top 5 for "white house" query despite being incorrect match.
